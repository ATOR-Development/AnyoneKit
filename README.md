# AnyoneKit

[![Version](https://img.shields.io/cocoapods/v/AnyoneKit.svg?style=flat)](https://cocoapods.org/pods/AnyoneKit)
[![License](https://img.shields.io/cocoapods/l/AnyoneKit.svg?style=flat)](https://cocoapods.org/pods/AnyoneKit)
[![Platform](https://img.shields.io/cocoapods/p/AnyoneKit.svg?style=flat)](https://cocoapods.org/pods/AnyoneKit)

AnyoneKit is the easiest way to embed the Anyone network in your iOS application.

Currently, the framework compiles in the following versions of `tor`, `libevent`, `openssl`, and `liblzma`:

| Component | Version  |
|:--------- | --------:|
| tor       | 0.4.8.12 |
| libevent  | 2.1.12   |
| OpenSSL   | 3.3.1    |
| liblzma   | 5.6.2    |
| Onionmasq | 0.6.2    |


## Example

To run the example project, clone the repo, and run `pod install` from the Example directory first.

## Requirements

- iOS 12.0 or later
- MacOS 10.13 or later
- Xcode 15.0 or later
- `autoconf`,  `automake`, `libtool` and  `gettext` in your `PATH`


## Installation

Install build tools via [Homebrew](https://brew.sh):

```sh
brew install automake autoconf libtool gettext
```

AnyoneKit is available through [CocoaPods](https://cocoapods.org). To install
it, simply add the following line to your Podfile:

If you use dynamic frameworks, use the root spec:

```ruby
use_frameworks!
pod 'AnyoneKit', '~> 408'
```

If you check out this repository directly, you will also need to fetch the submodules:

`git submodule update --init --recursive`

If you use it as a normal CocoaPods dependency, that will be done by CocoaPods.


## Preparing a new release

For maintainers/contributors of AnyoneKit, a new release should be prepared by 
doing the following:

Ensure that you have committed changes to the submodule trees for tor, libevent, openssl, and xz.

Also update info and version numbers in `README.md` and `AnyoneKit.podspec`!

Then lint like this:

```sh
pod lib lint --verbose --allow-warnings
```

(Use `verbose`, otherwise you'll get *very* bored.)

If the linting went well, create a git tag for the version, push to GitHub and then publish to CocoaPods:

```sh
pod trunk push --verbose --allow-warnings --skip-import-validation --skip-tests
```

(Unfortunately, you can not not lint on publish, so you might skip the first lint. However, `pod trunk push`
will take even longer, because it will clone everything fresh, too.)


Then create a [release](https://github.com/ATOR-Development/AnyoneKit/releases) in GitHub which corresponds
to the tag, and attach latest info as per older releases.


### Upgrading Tor

To upgrade Tor:

```bash
cd Tor/tor
git fetch
git checkout tor-0.4.8.12 # Find latest versions with git tag -l
rm -r * && git checkout . # Get rid of all autogenerated configuration files, which may not work with the newest version anymore.
git submodule update --init --recursive # Later Tor has submodules.
```

-> Test build by running the Example apps.

Check build output in the Report Navigator. (Last tab in the left pane.)


## Usage

Starting an instance of the Anyone client involves using three classes: `AnyoneThread`, `AnyoneConfiguration` and `AnyoneController`.

Here is an example of integrating Anyone with `NSURLSession`:

```objc
AnyoneConfiguration *configuration = [AnyoneConfiguration new];
configuration.ignoreMissingTorrc = YES;
configuration.cookieAuthentication = YES;
configuration.dataDirectory = [NSURL fileURLWithPath:NSTemporaryDirectory()];
configuration.controlSocket = [configuration.dataDirectory URLByAppendingPathComponent:@"control_port"];

AnyoneThread *thread = [[AnyoneThread alloc] initWithConfiguration:configuration];
[thread start];

NSData *cookie = configuration.cookie;
AnyoneController *controller = [[AnyoneController alloc] initWithSocketURL:configuration.controlSocket];

NSError *error;
[controller connect:&error];

if (error) {
    NSLog(@"Error: %@", error);
    return;
}

[controller authenticateWithData:cookie completion:^(BOOL success, NSError *error) {
    if (!success)
        return;

    [controller addObserverForCircuitEstablished:^(BOOL established) {
        if (!established)
            return;

        [controller getSessionConfiguration:^(NSURLSessionConfiguration *configuration) {
            NSURLSession *session = [NSURLSession sessionWithConfiguration:configuration];
            ...
        }];
    }];
}];
```


### GeoIP

If you want to use the provided GeoIP files, add this to your configuration:

```objc
AnyoneConfiguration *configuration = [AnyoneConfiguration new];
configuration.geoipFile = NSBundle.geoIpBundle.geoipFile;
configuration.geoip6File = NSBundle.geoIpBundle.geoip6File;
```


## Authors

### The original Tor.framework

- Conrad Kramer, conrad@conradkramer.com
- Chris Ballinger, chris@chatsecure.org
- Mike Tigas, mike@tig.as
- Benjamin Erhart, berhart@netzarchitekten.com

### AnyoneKit

- Benjamin Erhart, berhart@netzarchitekten.com


## License

AnyoneKit is available under the MIT license. See the 
[`LICENSE`](https://github.com/ATOR-Development/AnyoneKit/blob/pure_pod/LICENSE) file for more info.
